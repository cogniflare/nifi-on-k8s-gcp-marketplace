actions:
  - name: Wait up to 10m for nifi-cluster to start serving
    bashTest:
      script: |-
        timeout 600 bash -c 'while [[ "$(curl -s -o /dev/null -w ''%{http_code}'' http://nifi-cluster.$NAMESPACE.svc.cluster.local:8080/nifi/)" != "200" ]];  do sleep 5; done'
      expect:
        exitCode:
          equals: 0

  - name: Check if nifi-cluster is running properly
    bashTest:
      script: |-
        curl http://nifi-cluster.$NAMESPACE.svc.cluster.local:8080/nifi/
      expect:
        stdout:
          contains: 'Flow Configuration History'
